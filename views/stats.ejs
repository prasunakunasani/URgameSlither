<% include partials/header %>

<script>
    //All the variables declared are from the server to be used in the script.js file.
    //used '-' instead of '=' because '-' "outputs the unescaped value into the template"
    var avgSnakeLengthChartData = <%- JSON.stringify(avgSnakeLengths) %>
    var highestSnakeLengthChartData = <%- JSON.stringify(highestSnakeLengths) %>
    var bestScoreAndKillsChartData = <%- JSON.stringify(bestScoreAndKills) %>
    var cumulativeMovingScoreChartData = <%- JSON.stringify(cumulativeMovingScore) %>
    var avgSnakeLengthAllChartData = <%- JSON.stringify(avgSnakeLengthAll) %>
    var highestSnakeLengthAllChartData = <%- JSON.stringify(highestSnakeLengthAll) %>
    var totalGamesPlayedByUser = <%= usersStatsList.totals.deaths %>
    var avgScore = <%= (usersStatsList.totals.length / usersStatsList.totals.deaths).toFixed(0) %>
    var avgKills = <%= (usersStatsList.totals.boosts / usersStatsList.totals.deaths).toFixed(0) %>
    var avgBoosts = <%= (usersStatsList.totals.kills / usersStatsList.totals.deaths).toFixed(0) %>
</script>

<% include partials/nav %>


<div class=" container tab-content" id="myTabContent">
    <div class="tab-pane fade show active" id="profile" role="tabpanel" aria-labelledby="profile-tab">

        <div id="ajaxUpdateProfileStats">

            <div class="row card block">
                <div class="row">
                    <div class="col-sm-6 well">
                        <% if (usersStatsList.totals.deaths <= 0) { %>
                        Please play a game
                        <% } else { %>
                        <h5><%= usersList.snake.name %></h5>
                        <span style="position: absolute; bottom:4px">Last game played: <%= getMinutesAgo(usersStatsList.lastModifiedOn) %>
                            ago
                            <% } %>
                        </span>
                    </div>
                    <div class="col-sm-2 well imp main-red">
                        <div style="word-wrap:normal">Average Score</div>
                        <% if (isNaN(usersStatsList.totals.length / usersStatsList.totals.deaths)) { %>
                        <div>0</div>
                        <% } else { %>
                        <div><%= (usersStatsList.totals.length / usersStatsList.totals.deaths).toFixed(0) %></div>
                        <% } %>
                        <p id="progress0" data-min="0" data-max="<%= usersStatsList.totals.length %>"
                           data-mode="none"></p>
                    </div>
                    <div class="col-sm-2 well imp main-orange">
                        <div style="word-wrap:normal">Average Boosts</div>
                        <% if (isNaN(usersStatsList.totals.boosts / usersStatsList.totals.deaths)) { %>
                        <div>0</div>
                        <% } else { %>
                        <div><%= (usersStatsList.totals.boosts / usersStatsList.totals.deaths).toFixed(0) %></div>
                        <% } %>
                        <p id="progress1" data-min="0" data-max="<%= usersStatsList.totals.boosts %>"
                           data-mode="none"></p>
                    </div>
                    <div class="col-sm-2 well imp main-green">
                        <div style="word-wrap:normal">Average Kills</div>
                        <% if (isNaN(usersStatsList.totals.kills / usersStatsList.totals.deaths)) { %>
                        <div>0</div>
                        <% } else { %>
                        <div><%= (usersStatsList.totals.kills / usersStatsList.totals.deaths).toFixed(2) %></div>
                        <% } %>

                        <p id="progress2" data-min="0" data-max="<%= usersStatsList.totals.kills %>"
                           data-mode="none"></p>
                    </div>
                </div>
            </div>

            <div class="row" id="spacingBelowBox">

                <div class="col-sm box0">
                    <div class="box1 best">
                        <span class="fa fa-gamepad"></span>
                        <h4><%= usersStatsList.totals.length %></h4>
                        <span class="one-line">Total Score</span>
                    </div>
                </div>

                <div class="col-sm box0">
                    <div class="box1 best">
                        <span class="fa fa-trophy"></span>
                        <h4><%= usersStatsList.best_snake.length %></h4>
                        <span class="one-line">Best Score</span>
                    </div>
                </div>

                <div class="col-sm box0">
                    <div class="box1 best">
                        <span class="fa fa-clock-o"></span>
                        <h4><%= secondsToHms((usersStatsList.best_snake.duration).toFixed(0)) %></h4>
                        <span class="one-line">Best Time</span>
                    </div>
                </div>

                <div class="col-sm box0">
                    <div class="box1 boosts">
                        <span class="fa fa-bolt"></span>
                        <h4><%= usersStatsList.totals.boosts %></h4>
                        <span class="one-line">Total Boost</span>
                    </div>
                </div>

                <div class="col-sm box0">
                    <div class="box1 kills">
                        <span class="fa fa-gamepad"></span>
                        <h4> <%= usersStatsList.totals.kills %></h4>
                        <span class="one-line">Total Kills</span>
                    </div>
                </div>
                <div class="col-sm box0">
                    <div class="box1 kills">
                        <span class="fa fa-certificate"></span>
                        <h4><%= usersStatsList.records.largest_snake_killed_length %></h4>
                        <span class="one-line">Largest Kill</span>
                    </div>
                </div>

                <div class="col-sm box0">
                    <div class="box1 kills">
                        <span class="fa fa-gamepad"></span>
                        <h4><%= usersStatsList.records.highest_kills %></h4>
                        <span class="one-line">Highest Kills</span>
                    </div>
                </div>

                <div class="col-sm box0">
                    <div class="box1">
                        <span class="fa fa-play"></span>
                        <h4><%= usersStatsList.totals.deaths %></h4>
                        <span class="one-line">Games Played</span>
                    </div>
                </div>
            </div>  <!--end of row -> Single data value section -> Profile section-->

            <div class="row">
                <div class="col-sm-12 card">
                    <div  id="avgSnakeLengthchartdiv" class="amchart" aria-label="Average Score over time"></div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12 card">
                    <div id="highestSnakeLengthchartdiv" class="amchart" aria-label="Maximum Score over time"></div>
                </div>
            </div>

            <div class="row card">
                <div class="row">
                    <div class="col-sm-4 well">
                        <h5>Your Best Snake Game</h5>
                    </div>
                    <div class="col-sm-2 well imp main-red">
                        <div> Score: <%= usersStatsList.best_snake.length %></div>
                    </div>
                    <div class="col-sm-2 well imp main-orange">
                        <div> Kills: <%= usersStatsList.best_snake.kills %></div>
                    </div>
                    <div class="col-sm-2 well imp">
                        <div> Duration: <%= secondsToHms((usersStatsList.best_snake.duration).toFixed(0)) %></div>
                    </div>
                    <div class="col-sm-2 well imp">
                        <div> Boosts: <%= usersStatsList.best_snake.boosts %></div>
                    </div>
                </div>
                <div class="col-sm-12 ">
                    <div id="bestScoreAndKillschartdiv" class="amchart" aria-label="Best Game Score and Kills" ></div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12 card">
                    <div  id="cumulativeMovingScorechartdiv" class="amchart" aria-label="Cumulative score per game"></div>
                </div>
            </div>

        </div> <!--for ajax call-->

        <!--todo Make the graphs load with the ajax call as well-->

    </div> <!--tab-pane for profile-->
    <div class="tab-pane fade" id="global" role="tabpanel" aria-labelledby="global-tab">

        <div id="ajaxUpdateGlobalStats">
            <div class="row card block">
                <div class="row">
                    <div class="col-sm-5 well">
                        <h5>Daily/Global Stats</h5>
                    </div>
                    <div class="col-sm-2 well imp main-red">
                        <div> Peak Time</div>
                        <% if (!dailyStatsList.peak.time) { %>
                        Not Available
                        <% } else { %>
                        <%= getMinutesAgo(dailyStatsList.peak.time) %> ago
                        <% } %>
                    </div>
                    <div class="col-sm-2 well imp main-orange">
                        <div> Peak Users</div>
                        <% if (dailyStatsList.peak.concurrent == 0) { %>
                        Not Available
                        <% } else { %>
                        <%= dailyStatsList.peak.concurrent %>
                        <% } %>
                    </div>
                    <div class="col-sm-3 well imp main-green">
                        <div> Unique Users Today</div>
                        <div><%= dailyStatsList.totals.unique_users %></div>
                    </div>
                </div>  <!--end of row for main info section-->
               <br>
            </div>

            <div class="row" id="spacingBelowBox">
                <div class="col-sm box0">
                    <div class="box1 boosts">
                        <span class="fa fa-bolt"></span>
                        <h4><%= dailyStatsList.totals.boosts %></h4>
                        <div>Total Boosts Today</div>
                    </div>
                </div>
                <div class="col-sm box0">
                    <div class="box1">
                        <span class="fa fa-gamepad"></span>
                        <h4><%= dailyStatsList.totals.deaths %></h4>
                        <div>Total Games Today</div>
                    </div>
                </div>
                <div class="col-sm box0">
                    <div class="box1">
                        <span class="fa fa-clock-o"></span>
                        <h4><%= secondsToHms((dailyStatsList.totals.duration).toFixed(0)) %></h4>
                        <div>Total Time Played Today</div>
                    </div>
                </div>
                <div class="col-sm box0">
                    <div class="box1 kills">
                        <span class="fa fa-gamepad"></span>
                        <h4><%= dailyStatsList.totals.kills %></h4>
                        <div>Total Snake Kills Today</div>
                    </div>
                </div>
                <div class="col-sm box0">
                    <div class="box1 boosts">
                        <span class="fa fa-bolt"></span>
                        <h4><%= calculatedStatsList.totals.all_time.boosts %></h4>
                        <div>Total Boosts Used Ever</div>
                    </div>
                </div>
                <div class="col-sm box0">
                    <div class="box1">
                        <span class="fa fa-gamepad"></span>
                        <h4><%= calculatedStatsList.totals.all_time.deaths %></h4>
                        <div>Total Games Ever</div>
                    </div>
                </div>
                <div class="col-sm box0">
                    <div class="box1">
                        <span class="fa fa-clock-o"></span>
                        <h4><%= secondsToHms((calculatedStatsList.totals.all_time.duration).toFixed(0)) %></h4>
                        <div>Total Time Player Ever</div>
                    </div>
                </div>
                <div class="col-sm box0">
                    <div class="box1 kills">
                        <span class="fa fa-gamepad"></span>
                        <h4><%= calculatedStatsList.totals.all_time.kills %></h4>
                        <div>Total Snake Kills Ever</div>
                    </div>
                </div>
            </div>  <!--for row-->

            <div class="row">
                <div class="col-sm-12 card">
                    <div id="avgSnakeLengthAllchartdiv" class="amchart" aria-label="Average Snake Score of all users over 5 sec intervals" ></div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12 card">
                    <div id="highestSnakeLengthAllchartdiv" class="amchart" aria-label="Highest Snake Score of all users over 5 second intervals" ></div>
                </div>
            </div>

        </div> <!--for ajax call-->

    </div> <!--tab-pane for global-->
</div><!--For Container-->


<% include partials/footer %>
